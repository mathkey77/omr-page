<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>곽인영T - OMR 제출</title>
<style>
  body{font-family:system-ui,-apple-system,'Noto Sans KR',sans-serif;margin:0;padding:0;background:#f6f7fb;color:#111}
  .wrap{max-width:720px;margin:0 auto;padding:18px}
  header{padding:10px 0;text-align:center}
  h1{margin:6px 0;font-size:20px}
  .card{background:white;border-radius:10px;padding:12px;box-shadow:0 2px 10px rgba(0,0,0,0.06);margin-bottom:12px}
  label{display:block;margin-bottom:8px;font-weight:600}
  .row{display:flex;gap:8px}
  select,input[type=text]{flex:1;padding:10px;border-radius:8px;border:1px solid #ddd}
  .question{margin:10px 0;padding:10px;border-radius:8px;border:1px solid #eee}
  .opts{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .opt{flex:1;min-width:48px;background:#fafafa;border:1px solid #eee;padding:8px;border-radius:8px;text-align:center;cursor:pointer}
  .opt.selected{background:#2b7cff;color:white;border-color:#2b7cff}
  button{padding:12px;border-radius:10px;border:0;background:#2b7cff;color:white;font-weight:700;width:100%}
  .small{font-size:13px;color:#666;margin-top:8px}
  footer{font-size:13px;color:#777;text-align:center;margin-top:18px}
  @media (max-width:420px){ .row{flex-direction:column} }
</style>
</head>
<body>
<div class="wrap">
  <header><h1>주간테스트 OMR 제출</h1></header>

  <div class="card">
    <label>학년</label>
    <input type="text" id="grade" placeholder="예: 중1" />

    <label style="margin-top:10px">시험지 종류</label>
    <input type="text" id="paper" placeholder="예: A형" />

    <label style="margin-top:10px">유형명 (시험명)</label>
    <input type="text" id="typeName" placeholder="예: 2025-10-11 주간1" />

    <label style="margin-top:10px">학생 이름</label>
    <input type="text" id="studentName" placeholder="예: 홍길동" />

    <label style="margin-top:10px">학생 ID (선택)</label>
    <input type="text" id="studentID" placeholder="학번 등(선택)" />

    <label style="margin-top:10px">문제 수</label>
    <input type="text" id="qcount" placeholder="예: 20" />
    <div class="small">문제 수 입력 후 "문항 생성" 버튼을 눌러 주세요.</div>

    <div style="margin-top:10px;">
      <button id="gen">문항 생성</button>
    </div>
  </div>

  <div id="questionsContainer" class="card" style="display:none"></div>

  <div id="submitArea" style="display:none">
    <div class="card">
      <div class="small">정답 선택 후 아래 버튼을 누르면 새로운 창으로 채점 결과가 열립니다.</div>
      <div style="margin-top:10px">
        <button id="submitBtn">제출 & 채점</button>
      </div>
      <div style="margin-top:8px" class="small">참고: 제출하면 Submissions 시트에 기록됩니다.</div>
    </div>
  </div>

  <footer>곽인영T OMR 시스템</footer>
</div>

<script>
/* === IMPORTANT ===
  아래 SCRIPT_URL 을 Apps Script를 배포하고 얻은 웹앱 URL로 바꿔주세요.
  예: https://script.google.com/macros/s/AKfycbx.../exec
*/
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxxsrXyJUnEKUfxVuAbGgoRPoN9w2Drb7PCSYye-pMZuMM71iQKVjQZTQc5eno1-7Rl/exec";

function $(id){return document.getElementById(id)}

$('gen').addEventListener('click', () => {
  const cnt = parseInt($('qcount').value);
  if (!cnt || cnt <= 0 || cnt > 200) { alert("문제 수를 1~200 범위로 입력하세요."); return; }
  renderQuestions(cnt);
});

function renderQuestions(n) {
  const cont = $('questionsContainer');
  cont.innerHTML = "";
  for (let i=1;i<=n;i++) {
    const q = document.createElement('div');
    q.className = 'question';
    q.innerHTML = "<div><strong>문제 " + i + "</strong></div>";
    const opts = document.createElement('div');
    opts.className = 'opts';
    const choices = ['A','B','C','D','E'];
    choices.forEach(c=>{
      const d = document.createElement('div');
      d.className = 'opt';
      d.textContent = c;
      d.dataset.q = i;
      d.dataset.choice = c;
      d.addEventListener('click', optClick);
      opts.appendChild(d);
    });
    q.appendChild(opts);
    cont.appendChild(q);
  }
  cont.style.display = 'block';
  $('submitArea').style.display = 'block';
  window.scrollTo(0,document.body.scrollHeight);
}

function optClick(e){
  const parent = e.currentTarget.parentElement;
  // 같은 문항 내에서 선택 토글
  Array.from(parent.children).forEach(el => el.classList.remove('selected'));
  e.currentTarget.classList.add('selected');
}

$('submitBtn').addEventListener('click', () => {
  const grade = encodeURIComponent($('grade').value.trim());
  const paper = encodeURIComponent($('paper').value.trim());
  const typeName = encodeURIComponent($('typeName').value.trim());
  const studentName = encodeURIComponent($('studentName').value.trim());
  const studentID = encodeURIComponent($('studentID').value.trim());
  if (!grade || !paper || !typeName || !studentName) { alert("학년, 시험지 종류, 유형명, 학생 이름은 반드시 입력하세요."); return; }

  const qs = document.querySelectorAll('.question');
  if (qs.length === 0) { alert("문항을 생성하세요."); return; }

  const answers = [];
  for (let i=0;i<qs.length;i++) {
    const sel = qs[i].querySelector('.opt.selected');
    answers.push(sel ? sel.dataset.choice : "");
  }
  const answersStr = encodeURIComponent(answers.join(','));

  // view=html 로 하면 Apps Script가 보기좋은 HTML page로 결과를 보여줌 (새창으로 열기)
  const url = SCRIPT_URL + '?grade=' + grade + '&paper=' + paper + '&type=' + typeName
            + '&studentName=' + studentName + '&studentID=' + studentID
            + '&answers=' + answersStr + '&view=html';

  // 새 창에서 결과를 표시 (팝업 차단 시 새 탭)
  window.open(url, '_blank');
});
</script>
</body>
</html>
