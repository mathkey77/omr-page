<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OMR 테스트</title>
<style>
body {
  font-family: "Times New Roman", serif;
  background:#f8f9fa;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:20px;
}
.container {
  max-width:800px;
  background:#fff;
  padding:25px;
  border-radius:10px;
  box-shadow:0 4px 10px rgba(0,0,0,0.1);
}
h1 { text-align:center; color:#1e40af; margin-bottom:20px; }
.input-group { text-align:center; margin-bottom:20px; }
#omrForm { display:flex; flex-direction:column; align-items:center; gap:10px; margin-bottom:20px; }
.question { display:flex; align-items:center; justify-content:center; gap:10px; }
.qnum { width:30px; font-weight:bold; text-align:right; }
.options { display:flex; gap:8px; }
.option {
  width:40px; height:24px; border:1px solid #999; border-radius:12px;
  display:flex; align-items:center; justify-content:center; cursor:pointer;
  transition:0.2s;
  font-weight:bold; font-size:16px;
}
.option input { display:none; }
.option.checked { background:#1e40af; color:white; border-color:#1e40af; }
button {
  padding:10px 20px; font-size:16px; border:none; border-radius:5px;
  cursor:pointer; background:#1e40af; color:white; margin:0 5px;
}
button:hover { background:#1d4ed8; }
#result { text-align:center; font-weight:bold; margin-top:15px; font-size:18px; color:#065f46; }
</style>
</head>
<body>
<div class="container">
<h1>OMR 테스트</h1>

<div class="input-group">
<label>학년: <select id="grade"><option>1</option><option>2</option></select></label>
<label>반: <select id="class"><option>A</option><option>B</option></select></label>
</div>

<div class="input-group">
<label for="studentId">학생 ID:</label>
<input type="text" id="studentId" placeholder="ID를 입력하세요">
</div>

<form id="omrForm"></form>

<div class="input-group">
<button type="button" onclick="submitAndGrade()">채점</button>
</div>

<p id="result"></p>
</div>

<script>
const TOTAL_QUESTIONS = 15;
const WEBAPP_URL = '<WEBAPP_URL>'; // Google Apps Script URL
let correctAnswers = {};

// OMR 폼 생성
const omrForm = document.getElementById('omrForm');
for(let i=1;i<=TOTAL_QUESTIONS;i++){
  const qDiv = document.createElement('div');
  qDiv.className='question';
  qDiv.innerHTML=`<div class="qnum">${i}</div><div class="options"></div>`;
  const optionsDiv = qDiv.querySelector('.options');
  for(let j=1;j<=5;j++){
    const label = document.createElement('label');
    label.className='option';
    label.innerHTML=`<input type="radio" name="q${i}" value="${j}">${j}`;
    optionsDiv.appendChild(label);

    label.querySelector('input').addEventListener('change',function(){
      optionsDiv.querySelectorAll('.option').forEach(o=>o.classList.remove('checked'));
      label.classList.add('checked');
    });
  }
  omrForm.appendChild(qDiv);
}

// 정답 불러오기
async function fetchAnswers(){
  const grade = document.getElementById('grade').value;
  const cls = document.getElementById('class').value;
  try{
    const res = await fetch(`${WEBAPP_URL}?grade=${grade}&class=${cls}`);
    correctAnswers = await res.json();
  }catch(e){
    alert('정답 불러오기 실패');
    console.error(e);
  }
}

// 채점
async function submitAndGrade(){
  const studentId = document.getElementById('studentId').value.trim();
  if(!studentId){alert('학생 ID를 입력하세요'); return;}

  await fetchAnswers();

  let score=0, details='';
  for(let i=1;i<=TOTAL_QUESTIONS;i++){
    const sel = document.querySelector(`input[name="q${i}"]:checked`);
    const val = sel? sel.value : '-';
    if(val===correctAnswers['q'+i]) score++;
    details+=`Q${i}:${val} `;
  }

  document.getElementById('result').innerText = `${studentId} 님 점수: ${score} / ${TOTAL_QUESTIONS}`;

  // Google Sheets 기록
  const grade = document.getElementById('grade').value;
  const cls = document.getElementById('class').value;
  const time = new Date().toLocaleString();
  fetch(WEBAPP_URL,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({grade, class:cls, studentId, score, time, details})
  }).then(res=>res.json()).then(res=>console.log(res)).catch(err=>console.error(err));
}
</script>
</body>
</html>
